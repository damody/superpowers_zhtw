---
name: finishing-a-development-branch
description: 當實作完成、所有測試通過且您需要決定如何整合工作時使用 - 通過呈現合併、PR 或清理的結構化選項來指導開發工作的完成
---

# 完成開發分支

## 概述

通過呈現清晰的選項和處理所選工作流程來指導開發工作的完成。

**核心原則：** 驗證測試 → 呈現選項 → 執行選擇 → 清理。

**開始時宣告：** 「我正在使用 finishing-a-development-branch 技能完成此工作。」

## 流程

### 步驟 1：驗證測試

**在呈現選項之前，驗證測試通過：**

```bash
# 運行專案的測試套件
npm test / cargo test / pytest / go test ./...
```

**如果測試失敗：**
```
測試失敗（<N> 個失敗）。必須在完成前修復：

[顯示失敗]

在測試通過之前無法繼續合併/PR。
```

停止。不要繼續步驟 2。

**如果測試通過：** 繼續步驟 2。

### 步驟 2：確定基礎分支

```bash
# 嘗試常見的基礎分支
git merge-base HEAD main 2>/dev/null || git merge-base HEAD master 2>/dev/null
```

或詢問：「此分支從 main 分出 - 這正確嗎？」

### 步驟 3：呈現選項

呈現恰好這 4 個選項：

```
實作完成。您想做什麼？

1. 本地合併回 <base-branch>
2. 推送並創建 Pull Request
3. 保持分支原樣（我稍後處理）
4. 丟棄此工作

選擇哪個選項？
```

**不要添加解釋** - 保持選項簡潔。

### 步驟 4：執行選擇

#### 選項 1：本地合併

```bash
# 切換到基礎分支
git checkout <base-branch>

# 拉取最新
git pull

# 合併功能分支
git merge <feature-branch>

# 驗證合併結果的測試
<test command>

# 如果測試通過
git branch -d <feature-branch>
```

然後：清理工作樹（步驟 5）

#### 選項 2：推送並創建 PR

```bash
# 推送分支
git push -u origin <feature-branch>

# 創建 PR
gh pr create --title "<title>" --body "$(cat <<'EOF'
## 摘要
<2-3 個要點說明更改內容>

## 測試計劃
- [ ] <驗證步驟>
EOF
)"
```

然後：清理工作樹（步驟 5）

#### 選項 3：保持原樣

報告：「保持分支 <name>。工作樹保留在 <path>。」

**不要清理工作樹。**

#### 選項 4：丟棄

**首先確認：**
```
這將永久刪除：
- 分支 <name>
- 所有提交：<commit-list>
- 位於 <path> 的工作樹

輸入 'discard' 確認。
```

等待確切的確認。

如果確認：
```bash
git checkout <base-branch>
git branch -D <feature-branch>
```

然後：清理工作樹（步驟 5）

### 步驟 5：清理工作樹

**對於選項 1、2、4：**

檢查是否在工作樹中：
```bash
git worktree list | grep $(git branch --show-current)
```

如果是：
```bash
git worktree remove <worktree-path>
```

**對於選項 3：** 保持工作樹。

## 快速參考

| 選項 | 合併 | 推送 | 保持工作樹 | 清理分支 |
|------|------|------|------------|---------|
| 1. 本地合併 | ✓ | - | - | ✓ |
| 2. 創建 PR | - | ✓ | ✓ | - |
| 3. 保持原樣 | - | - | ✓ | - |
| 4. 丟棄 | - | - | - | ✓（強制） |

## 常見錯誤

**跳過測試驗證**
- **問題：** 合併損壞的代碼，創建失敗的 PR
- **修復：** 在提供選項之前總是驗證測試

**開放式問題**
- **問題：** 「我接下來應該做什麼？」 → 模糊
- **修復：** 呈現恰好 4 個結構化選項

**自動清理工作樹**
- **問題：** 在可能需要時刪除工作樹（選項 2、3）
- **修復：** 僅對選項 1 和 4 清理

**丟棄時沒有確認**
- **問題：** 意外刪除工作
- **修復：** 要求輸入 "discard" 確認

## 紅旗警示

**絕不：**
- 在測試失敗時繼續
- 不驗證結果測試就合併
- 不確認就刪除工作
- 不明確請求就強制推送

**總是：**
- 在提供選項之前驗證測試
- 呈現恰好 4 個選項
- 對選項 4 獲得輸入確認
- 僅對選項 1 和 4 清理工作樹

## 整合

**被調用：**
- **subagent-driven-development**（步驟 7）- 所有任務完成後
- **executing-plans**（步驟 5）- 所有批次完成後

**配對使用：**
- **using-git-worktrees** - 清理該技能創建的工作樹
